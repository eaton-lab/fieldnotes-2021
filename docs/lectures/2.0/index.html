
<!doctype html>
<html lang="en-US">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="author" content="Deren Eaton">
    <meta name="description" content="Programming Course">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lecture-2.0</title>

    <!-- CSS styling -->
    <link rel="stylesheet" href="../reveal/css/reveal.css">
    <link rel="stylesheet" href="../hack-the-planet.css">
    <link rel="stylesheet" href="../reveal/lib/css/zenburn.css">    
    <link rel="stylesheet" href="./custom.css">

    <!-- support printing in chrome -->
    <script>
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match( /print-pdf/gi ) ? '../reveal/css/print/pdf.css' : '../reveal/css/print/paper.css';
            document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>    
</head>


<!-- Not sure yet of this transition effect -->
<body style="transition: transform 0.8s ease 0s;"> 

    <!-- set reveal defaults ... -->
    <div class="reveal linear" data-transition-speed="default" data-background-transition="default">

        <!-- By giving slides a dimension we can use pixels or % -->
        <div class="slides" style="width:1600px; height:900px;">

            <section data-background-color="#262626" class="present" data-transition="none">
                <div style="margin-left: auto; margin-top: 15%">
                    <h2 class="title" style="color:#5ab4ac;line-height: 1.25">
                    Programming and Data Science for Biology<br>(EEEB G4050)</h2>

                    <h4 style="color:grey; font-weight: 400; line-height: 1.5"> 
                    <i>Dept. of Ecology, Evolution, and Environmental Biology<br>
                    Columbia University</i></h4>
                </div>
            </section>


            <section data-background-color="#262626" data-transition="none" class="future">
                <div class="standard">
                    <h3 class="title" style="color:#5ab4ac; margin-top:10%; line-height:1.2">
                    Lecture 2.0 Outline:</h3>
                    <div class="textbox"><p style='text-align:center; color:white'>
                    <ul style="color:white; line-height: 1.5; font-size: 1.25em">
                        <li>poll results</li>
                        <li>program design</li>
                        <li>dev tips</li>                        
                    </ul>
                    </div>
            </section>


            <section data-background-color="#262626" data-transition="none" class="future">

                <section data-background-color="#262626" data-transition="none" class="future">                
                    <div class="standard">
                        <h3 class="title" style="color:#5ab4ac; margin-top:12%; line-height:1.2">
                        Poll results: Programming experience</h3>
                        <div class="textbox"><p style='text-align:center; color:white'>
                            Experience is quite varied. This is a good thing. For beginners,
                            you can seek help from more advanced students. For advanced students,
                            you can learn a lot about coding, and teaching, by troubleshooting problems that others encounter.</p></div>
                            <img src="./poll-1.png" style="width:60%">
                    </div>
                </section>

                <section data-background-color="#262626" data-transition="none" class="future">                
                    <div class="standard">
                        <h3 class="title" style="color:#5ab4ac; margin-top:12%; line-height:1.2">
                        Poll results: Programming experience</h3>
                        <div class="textbox"><p style='text-align:center; color:white'>
                            Experience is quite varied. This is a good thing. For beginners,
                            you can seek help from more advanced students. For advanced students,
                            you can learn a lot about coding, and teaching, by troubleshooting problems that others encounter.</p></div>
                            <img src="./poll-2.png" style="width:60%">
                    </div>
                </section>

                <section data-background-color="#262626" data-transition="none" class="future">                
                    <div class="standard">
                        <h3 class="title" style="color:#5ab4ac; margin-top:12%; line-height:1.2">
                        Poll results: Programming experience</h3>
                        <div class="textbox"><p style='text-align:center; color:white'>
                            Experience is quite varied. This is a good thing. For beginners,
                            you can seek help from more advanced students. For advanced students,
                            you can learn a lot about coding, and teaching, by troubleshooting problems that others encounter.</p></div>
                            <img src="./poll-3.png" style="width:60%">
                    </div>
                </section>

                <section data-background-color="#262626" data-transition="none" class="future">                
                    <div class="standard">
                        <h3 class="title" style="color:#5ab4ac; margin-top:12%; line-height:1.2">
                        Poll results: Programming experience</h3>
                        <div class="textbox"><p style='text-align:center; color:white'>
                            Experience is quite varied. This is a good thing. For beginners,
                            you can seek help from more advanced students. For advanced students,
                            you can learn a lot about coding, and teaching, by troubleshooting problems that others encounter.</p></div>
                            <img src="./poll-4.png" style="width:60%">
                    </div>
                </section>                                                



            </section>            



            <section data-background-color="#262626" data-transition="none" class="future">
                <div class="standard">
                    <h3 class="title" style="color:#5ab4ac; margin-top:12%; line-height:1.2">
                    Poll results: </h3>
                    <div class="textbox"><p style='text-align:center; color:white'>
                        Do you have a program in mind that you wish to develop? 
                        <br>Example responses (paraphrased):
                        <ul style="color:#d8b365; font-size:1em; line-height: 1.5">
                            <li class="items">input is data (e.g., CSV); analysis is statistical; output is result/plot/etc.</li>
                            <li class="items">input is a complex document (e.g., PDF); data is parsed from it, transformed, and returned.</li>
                            <li class="items">input is args/params; data is extracted  
                            from online database; analysis; return result/plot/etc.</li>
                            <li class="items">input is args/params; analysis uses wrapper around existing software; return formatted result.</li>
                        </ul>
                    </p>
                    </div>
                </div>
            </section>



            <section data-background-color="#262626" data-transition="none" class="future">
                <div class="standard">
                    <h3 class="title" style="color:#5ab4ac; margin-top:10%; line-height:1.2">
                    Dev tip: design for the style of use</h3>
                    <div class="textbox"><p style='text-align:center; color:white'>
                        Will the user only interact with the program once? (e.g., genome assembly)
                        <ul style="color:#d8b365; font-size:0.9em; line-height: 1.5; margin-left: 15%; margin-right: 15%">
                            <li class="items">Checkpointing to restart if interrupted.</li>
                            <li class="items">Progress bar for indication.</li>
                            <li class="items">Log file of the parameters/settings used.</li>
                            <li class="items">Designed to run in terminal (e.g., on a server).</li>
                    </p></div>

                    <div class="textbox"><p style='text-align:center; color:white'>
                        Or will they use the program interactively, tweaking options? (e.g., plotting tools)
                    </p></div>
                        <ul style="color:#d8b365; font-size:0.9em; line-height: 1.5; margin-left: 15%; margin-right: 15%">
                            <li class="items">Fast and responsive.</li>
                            <li class="items">Auto-completion (tab) support (cleaned).</li>
                            <li class="items">Designed to run in interactive env (e.g., jupyter, RStudio).</li>
                        </ul>
                </div>
            </section>



            <section data-background-color="#262626" data-transition="none" class="future">

                <section data-background-color="#262626" data-transition="none" class="future">                
                    <div class="standard">
                        <h3 class="title" style="color:#5ab4ac; margin-top:7%; line-height:1.2">
                        Example: ipyrad vs. stacks</h3>
                        <div class="textbox"><p style='text-align:center; color:white'>
                            Genomic assembly software for RAD-seq type data. Two tools took fairly 
                            different design approaches. 

                            Stacks follows the design of a unix type program, requiring the
                            user to enter all arguments individually to several atomized sub-programs. 
                            The authors provide bash script templates (e.g., for-loops) to run the 
                            entire workflow, composing many steps. It is easy for a typo or bug in 
                            the script to crash the whole workflow.
                            <br><br>
                            ipyrad is also designed as a command line tool, but takes a single params
                            file as input, in which the user can enter all parameters. ipyrad then 
                            creates the full workflow, managing all files from one atomic 
                            subprogram to the next.
                        </p></div>
                    </div>
                </section>

                <section data-background-color="#262626" data-transition="none" class="future">
                    <div class="standard">
                        <div class="textbox"><p style='text-align:center; color:white'>
                        Stacks bash script requires user to enter every sample name <i>by hand</i>! 
                        and to write for-loops, and call several tools, to run just part of the workflow.
                        </p></div>
                    </div>
<pre style="width:60%"><code class="bash" style="max-height: 650px; font-size: 18px; line-height:1.35;"> 
#!/bin/bash

src=$HOME/research/project

files=”sample_01
sample_02
sample_03”

#
# Build loci de novo in each sample for the single-end reads only. If paired-end reads are available, 
# they will be integrated in a later stage (tsv2bam stage).
# This loop will run ustacks on each sample, e.g.
#   ustacks -f ./samples/sample_01.1.fq.gz -o ./stacks -i 1 --name sample_01 -M 4 -p 8
#
id=1
for sample in $files
do
    ustacks -f $src/samples/${sample}.1.fq.gz -o $src/stacks -i $id --name $sample -M 4 -p 8
    let "id+=1"
done

# 
# Build the catalog of loci available in the metapopulation from the samples contained
# in the population map. To build the catalog from a subset of individuals, supply
# a separate population map only containing those samples.
#
cstacks -n 6 -P $src/stacks/ -M $src/popmaps/popmap -p 8

#
# Run sstacks. Match all samples supplied in the population map against the catalog.
#
sstacks -P $src/stacks/ -M $src/popmaps/popmap -p 8

#
# Run tsv2bam to transpose the data so it is stored by locus, instead of by sample. We will include
# paired-end reads using tsv2bam. tsv2bam expects the paired read files to be in the samples
# directory and they should be named consistently with the single-end reads,
# e.g. sample_01.1.fq.gz and sample_01.2.fq.gz, which is how process_radtags will output them.
#
tsv2bam -P $src/stacks/ -M $src/popmaps/popmap --pe-reads-dir $src/samples -t 8

#
# Run gstacks: build a paired-end contig from the metapopulation data (if paired-reads provided),
# align reads per sample, call variant sites in the population, genotypes in each individual.
#
gstacks -P $src/stacks/ -M $src/popmaps/popmap -t 8

#
# Run populations. Calculate Hardy-Weinberg deviation, population statistics, f-statistics
# export several output files.
#
populations -P $src/stacks/ -M $src/popmaps/popmap -r 0.65 --vcf --genepop --structure --fstats --hwe -t 8
</code></pre>
                </section>

                <section data-background-color="#262626" data-transition="none" class="future">
                    <div class="standard">
                        <div class="textbox"><p style='text-align:center; color:white'>
                        By contrast, ipyrad allows users to set all parameters in a single file,
                        to run the entire assembly in one command.
                        </p></div>
                    </div>
                <pre style="width:60%"><code class="bash" style="max-height: 650px; font-size: 18px; line-height:1.35;"> 
# create a default parameter file
ipyrad -n test

# run all steps of the assembly using setting in params-test.txt
ipyrad -p params-test.txt -s 1234567
                </code></pre>
                    <br>
                    <div class="standard">
                        <div class="textbox"><p style='text-align:center; color:white'>
                        And if the user wants to test different parameter settings, you can
                        create a branched at a checkpoint (1-7) and continue from that
                        point with different parameters.
                    </p></div>                        

                <pre style="width:60%"><code class="bash" style="max-height: 650px; font-size: 18px; line-height:1.35;"> 
# create a default parameter file
ipyrad -p params-test.txt -b newparams

# run all steps of the assembly using setting in params-test.txt
ipyrad -p newparams-test.txt -s 67
                </code></pre>


                </section>
            </section>






            <section data-background-color="#262626" data-transition="none" class="future">
                <div class="standard">
                    <h3 class="title" style="color:#5ab4ac; margin-top:4%; line-height:1.2">
                    Dev tip: Code for extendability</h3>
                    <div class="textbox"><p style='text-align:center; color:white'>
                        Command line interface (CLI) vs Application programming interface (API)
                    </p></div>

                <pre style="width:60%"><code class="bash" style="max-height: 650px; font-size: 18px; line-height:1.35;"> 
# BASH: supply a series of args to create drawing.
toytree --tree "((a,b),c);" \
        --format SVG \
        --tip-colors red \
        --node-sizes 10 \
        --edge-style c ...
                </code></pre>

                <pre style="width:60%"><code class="bash" style="max-height: 650px; font-size: 18px; line-height:1.35;"> 
# PYTHON: init a tree object into memory and use it in many ways...
tree = toytree.tree("((a,b),c);")

# transform the tree in various ways
rtree = tree.rooted("c")

# draw and tweak styling interactively while viewing outputs
rtree.draw(
    tip_colors='red',
    node_sizes=10,
    edge_style='c',
    ...
)
                </code></pre>
                </div>
            </section>



            <section data-background-color="#262626" data-transition="none" class="future">
                <div class="standard">
                    <h3 class="title" style="color:#5ab4ac; margin-top:12%; line-height:1.2">
                    Dev tip: Ensure Accessibility</h3>
                    <div class="textbox"><p style='text-align:center; color:white'>
                        Are the data and dependencies accessible, reliable, and open source?</h3>
                        <ul style="color:#d8b365; font-size:0.9em; line-height: 1.5; margin-left: 10%; margin-right: 10%">
                            <li class="items">Extracting data from a database that may change format, or has limits on access (e.g., NCBI).</li>
                            <li class="items">Requiring licensed software as a dependency.</li>
                            <li class="items">Using proprietary or complex data formats (e.g., MS Excel).</li>
                            <li class="items">Requiring too many dependencies (likely to break).</li>
                            <li class="items">Requiring multiple non-standard and specific language versions<br> (e.g., R v3.0 and Julia v1.0 and Python v2.7 ...).</li>
                        </ul>
                    </p>
                    </div>
                </div>
            </section>



            <section data-background-color="#262626" data-transition="none" class="future">
                <div class="standard">
                    <h3 class="title" style="color:#5ab4ac; margin-top:12%; line-height:1.2">
                    Dev tip: Is a program needed?</h3>
                    <div class="textbox"><p style='text-align:center; color:white'>
                        If your goal is to complete a one-off analysis, then creating a well documented
                        script (e.g., using Markdown, jupyter, etc.) that uses simple and standard tools
                        (e.g., basic R, Python, or bash) will be much more clear, readable, and 
                        reproducible, than to develop a complex tool where the analysis details are obscured
                        in source code. 
                        <ul style="color:#d8b365; font-size:0.9em; line-height: 1.5; margin-left: 10%; margin-right: 10%">
                            <li class="items">Balancing complexity versus readability.</li>
                            <li class="items">Scripting is often fine, not every problem needs a new tool.</li>
                            <li class="items">Is there a tool that already accomplishes this task (can I contribute to it?).</li>
                            <li class="items">Should I develop a new tool, or a wrapper around an existing one?</li>
                        </ul>
                    </p>
                    </div>
                </div>
            </section>


        <!-- SLIDES CLASS ENDING -->
        </div>

    <!-- REVEAL LINEAR CENTER CLASS ENDING -->
    </div>


    <!-- JAVASCRIPT -->
    <script src="../reveal/lib/js/head.min.js" type="text/javascript"></script>        
    <script src="../reveal/js/reveal.js" type="text/javascript"></script>
    <script src="../reveal/plugin/highlight/highlight.js" type="text/javascript"></script>
    <script>
        Reveal.initialize({
            controls:true, 
            progress:false, 
            loop:false, 
            history:true,
            center:false,
            fragmentInURL:false,
            margin:.05,
            minScale:0.1,
            maxScale:5,
            width:1600,
            height:900,
            theme:Reveal.getQueryHash().theme,
            transition:Reveal.getQueryHash().transition||"linear",
            slideNumber: false,
            // slideNumber: "h/v",
            dependencies: [
            // { src: '../reveal/lib/js/classList.js', condition: function() { return !document.body.classList; } },
            { src: '../reveal/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
            ]
        });
    </script>
</body>
</html>